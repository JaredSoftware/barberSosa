import{a as p}from"./DxZUp_Ia.js";import{u as w}from"./DD9xvv_g.js";var E={};const u=()=>typeof window<"u"?window.location.origin:E.NUXT_PUBLIC_API_BASE||"http://10.90.61.11",h={async getAll(o=!0){try{const e=`${u()}/api/offers${o?"?active=true":""}`;console.log("ðŸ”„ Solicitando ofertas desde:",e);const n=await fetch(e,{headers:{"Content-Type":"application/json"},cache:"no-store"});if(!n.ok)throw new Error("Error al obtener ofertas");const t=await n.json();return console.log("ðŸ“¦ Ofertas recibidas del backend:",t),console.log("ðŸ“Š Resumen por campo premium:",{total:t.length,premium:t.filter(l=>l.premium===!0).length,noPremium:t.filter(l=>l.premium!==!0).length,sinCampo:t.filter(l=>!("premium"in l)).length}),t}catch(r){return console.error("Error obteniendo ofertas:",r),[]}},async getById(o){try{const r=u(),e=await fetch(`${r}/api/offers/${o}`,{headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Error al obtener la oferta");return await e.json()}catch(r){return console.error("Error obteniendo oferta:",r),null}},async create(o,r){try{const e=u(),n=await fetch(`${e}/api/offers`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(o)});if(!n.ok){const t=await n.json().catch(()=>({message:"Error al crear la oferta"})),l=t.message||(Array.isArray(t)?t.map(f=>f.message||f).join(", "):"Error al crear la oferta");throw new Error(l)}return await n.json()}catch(e){throw console.error("Error creando oferta:",e),e}},async update(o,r,e){try{const n=u(),t=await fetch(`${n}/api/offers/${o}`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok){const l=await t.json().catch(()=>({message:"Error al actualizar la oferta"})),f=l.message||(Array.isArray(l)?l.map(d=>d.message||d).join(", "):"Error al actualizar la oferta");throw new Error(f)}return await t.json()}catch(n){throw console.error("Error actualizando oferta:",n),n}},async delete(o,r){try{const e=u();if(!(await fetch(`${e}/api/offers/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}})).ok)throw new Error("Error al eliminar la oferta");return!0}catch(e){throw console.error("Error eliminando oferta:",e),e}}},A=()=>{const o=w("offers",()=>[]),r=w("offers_loading",()=>!1),e=w("offers_error",()=>null);return{offers:o,loading:r,error:e,fetchOffers:async(c=!0,s=!1)=>{r.value=!0,e.value=null;try{s&&(o.value=[]);const a=await h.getAll(c);return o.value=a,console.log("âœ… useOffers: estado actualizado con",o.value.length,"ofertas"),o.value}catch(a){return e.value=a.message||"Error al obtener ofertas",console.error("Error obteniendo ofertas:",a),[]}finally{r.value=!1}},fetchOfferById:async c=>{r.value=!0,e.value=null;try{return await h.getById(c)}catch(s){return e.value=s.message||"Error al obtener la oferta",console.error("Error obteniendo oferta:",s),null}finally{r.value=!1}},createOffer:async c=>{const s=p.getToken();if(!s)throw new Error("No autenticado");r.value=!0,e.value=null;try{const a=await h.create(c,s);return o.value.push(a),a}catch(a){throw e.value=a.message||"Error al crear la oferta",a}finally{r.value=!1}},updateOffer:async(c,s)=>{const a=p.getToken();if(!a)throw new Error("No autenticado");r.value=!0,e.value=null;try{const i=await h.update(c,s,a),y=o.value.findIndex(m=>m._id===c);return y!==-1&&(o.value[y]=i),i}catch(i){throw e.value=i.message||"Error al actualizar la oferta",i}finally{r.value=!1}},deleteOffer:async c=>{const s=p.getToken();if(!s)throw new Error("No autenticado");r.value=!0,e.value=null;try{return await h.delete(c,s),o.value=o.value.filter(a=>a._id!==c),!0}catch(a){throw e.value=a.message||"Error al eliminar la oferta",a}finally{r.value=!1}}}};export{A as u};
