import{_ as M}from"./DaIHgnVo.js";import{u as Q}from"./CFgllcZz.js";import{u as U}from"./DbmS-_H1.js";import{u as W}from"./wmd5FtzM.js";import{r as $,e as q,f as Y,g as A,c as i,a as t,h as b,i as e,n as G,t as s,b as H,w as J,F as K,j as O,o as c,d as X}from"./DubxvCNo.js";import"./DD9xvv_g.js";import"./DxZUp_Ia.js";const Z={class:"min-h-screen bg-background-deep py-8 px-4"},tt={class:"max-w-6xl mx-auto"},et={class:"font-bold"},rt={class:"mb-8"},at={class:"text-3xl md:text-4xl font-display font-black text-white uppercase tracking-[0.2em] mb-2"},st={class:"text-gray-400 text-sm tracking-wide"},ot={key:1,class:"text-center py-12"},nt={class:"text-gray-400 mt-4"},lt={key:2,class:"text-center py-20"},it={class:"text-2xl font-display text-white mb-4"},ct={class:"text-gray-400 mb-8"},dt={key:3,class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},ut={class:"lg:col-span-2 space-y-4"},pt={class:"w-24 h-24 bg-accent-gray rounded overflow-hidden flex-shrink-0"},mt=["src","alt"],bt={class:"flex-1 flex flex-col justify-between"},xt={class:"text-white font-bold text-lg mb-1"},yt={class:"text-gray-400 text-sm"},gt={class:"flex items-center gap-4"},_t={class:"flex items-center gap-2 border border-primary/30 rounded-sm"},ht=["onClick","disabled"],ft={class:"px-3 text-white font-bold"},vt=["onClick","disabled"],wt={class:"text-white font-bold text-lg"},kt=["onClick","aria-label","disabled"],Ct={class:"lg:col-span-1"},It={class:"bg-dark-gray border border-primary/20 rounded-sm p-6 sticky top-24"},Et={class:"text-white font-display font-bold text-xl uppercase tracking-wider mb-6"},Ft={class:"space-y-4 mb-6"},Pt={class:"flex justify-between text-gray-400"},$t={class:"flex justify-between text-gray-400"},qt={class:"border-t border-primary/20 pt-4 flex justify-between text-white font-bold text-xl"},jt={class:"mb-6 p-4 bg-amber-900/20 border border-amber-600/50 rounded-sm flex gap-3"},Nt={class:"text-amber-200 text-sm"},Bt={key:0,class:"text-red-400 text-sm mb-3"},St=["disabled"],Vt=["disabled"],Wt={__name:"cart",setup(Dt){const{cart:p,loading:j,totalItems:x,paymentLoading:y,error:g,fetchCart:_,updateCartItem:h,removeFromCart:N,clearCart:f,createPaymentPreference:B}=Q(),{products:v,fetchProducts:S}=U(),{t:m}=W(),o=m,l=$(!1),V=`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 400'%3E%3Crect fill='%23333' width='400' height='400'/%3E%3Ctext fill='%23666' x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='18'%3E${encodeURIComponent(o("catalog.noImage"))}%3C/text%3E%3C/svg%3E`,w=q(()=>!p.value.items||!v.value?[]:p.value.items.map(r=>{const a=v.value.find(u=>u._id===r.productId);return{...r,product:a}})),k=q(()=>w.value.reduce((r,a)=>{var n;const u=((n=a.product)==null?void 0:n.price)||0;return r+u*a.quantity},0)),D=async r=>{l.value=!0;try{await h(r.productId,r.quantity+1)}catch(a){console.error("Error incrementando cantidad:",a)}finally{l.value=!1}},L=async r=>{if(r.quantity<=1){C(r.productId);return}l.value=!0;try{await h(r.productId,r.quantity-1)}catch(a){console.error("Error decrementando cantidad:",a)}finally{l.value=!1}},C=async r=>{if(confirm(o("cart.removeConfirm"))){l.value=!0;try{await N(r)}catch(a){console.error("Error eliminando producto:",a)}finally{l.value=!1}}},R=async()=>{if(confirm(o("cart.clearConfirm"))){l.value=!0;try{await f()}catch(r){console.error("Error vaciando carrito:",r)}finally{l.value=!1}}},T=async()=>{try{const r=await B(),a=r.sandbox_init_point||r.init_point;a&&(window.location.href=a)}catch(r){console.error("Error al iniciar pago:",r)}},z=Y(),d=$(null);return A(async()=>{await _(),await S();const r=z.query.payment;r==="success"?(d.value={type:"success",text:m("cart.paymentSuccess")},await f(),await _()):r==="failure"?d.value={type:"failure",text:m("cart.paymentFailure")}:r==="pending"&&(d.value={type:"pending",text:m("cart.paymentPending")})}),(r,a)=>{const u=M;return c(),i("div",Z,[t("div",tt,[e(d)?(c(),i("div",{key:0,class:G(["mb-6 p-4 rounded-sm border",e(d).type==="success"?"bg-green-900/30 border-green-600 text-green-200":e(d).type==="failure"?"bg-red-900/30 border-red-600 text-red-200":"bg-amber-900/30 border-amber-600 text-amber-200"])},[t("p",et,s(e(d).text),1)],2)):b("",!0),t("div",rt,[t("h1",at,s(e(o)("cart.title")),1),t("p",st,s(e(x))+" "+s(e(x)===1?e(o)("cart.itemSingular"):e(o)("cart.itemPlural"))+" "+s(e(o)("cart.inYourCart")),1)]),e(j)?(c(),i("div",ot,[a[0]||(a[0]=t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"},null,-1)),t("p",nt,s(e(o)("cart.loading")),1)])):!e(p).items||e(p).items.length===0?(c(),i("div",lt,[a[2]||(a[2]=t("span",{class:"material-symbols-outlined text-6xl text-gray-600 mb-4"},"shopping_cart",-1)),t("h2",it,s(e(o)("cart.emptyTitle")),1),t("p",ct,s(e(o)("cart.emptyDescription")),1),H(u,{to:"/catalogo",class:"inline-flex items-center gap-2 px-6 py-3 bg-gold-gradient text-background-deep font-bold uppercase text-xs tracking-widest rounded-sm hover:brightness-110 transition-all"},{default:J(()=>[a[1]||(a[1]=t("span",{class:"material-symbols-outlined"},"storefront",-1)),X(" "+s(e(o)("cart.viewCatalog")),1)]),_:1,__:[1]})])):(c(),i("div",dt,[t("div",ut,[(c(!0),i(K,null,O(e(w),n=>{var I,E,F;return c(),i("div",{key:n.productId,class:"bg-dark-gray border border-primary/20 rounded-sm p-4 flex gap-4"},[t("div",pt,[n.product?(c(),i("img",{key:0,src:n.product.image||V,alt:((I=n.product)==null?void 0:I.name)||e(o)("cart.productFallback"),class:"w-full h-full object-cover"},null,8,mt)):b("",!0)]),t("div",bt,[t("div",null,[t("h3",xt,s(((E=n.product)==null?void 0:E.name)||e(o)("cart.loadingProduct")),1),t("p",yt,s(((F=n.product)==null?void 0:F.category)||""),1)]),t("div",gt,[t("div",_t,[t("button",{onClick:P=>L(n),class:"px-3 py-1 text-primary hover:bg-primary/10 transition-all",disabled:e(l)}," - ",8,ht),t("span",ft,s(n.quantity),1),t("button",{onClick:P=>D(n),class:"px-3 py-1 text-primary hover:bg-primary/10 transition-all",disabled:e(l)}," + ",8,vt)]),t("p",wt," $"+s(n.product?(n.product.price*n.quantity).toFixed(2):"0.00"),1)])]),t("button",{onClick:P=>C(n.productId),class:"text-gray-500 hover:text-red-500 transition-all","aria-label":e(o)("cart.removeItem"),disabled:e(l)},a[3]||(a[3]=[t("span",{class:"material-symbols-outlined"},"delete",-1)]),8,kt)])}),128))]),t("div",Ct,[t("div",It,[t("h2",Et,s(e(o)("cart.summary")),1),t("div",Ft,[t("div",Pt,[t("span",null,s(e(o)("cart.subtotal")),1),t("span",null,"$"+s(e(k).toFixed(2)),1)]),t("div",$t,[t("span",null,s(e(o)("cart.shipping")),1),t("span",null,s(e(o)("cart.shippingCheckout")),1)]),t("div",qt,[t("span",null,s(e(o)("cart.total")),1),t("span",null,"$"+s(e(k).toFixed(2)),1)])]),t("div",jt,[a[4]||(a[4]=t("span",{class:"material-symbols-outlined text-amber-400 flex-shrink-0"},"local_shipping",-1)),t("p",Nt,s(e(o)("cart.noShippingNotice")),1)]),e(g)?(c(),i("p",Bt,s(e(g)),1)):b("",!0),t("button",{class:"w-full py-4 bg-gold-gradient text-background-deep font-black uppercase text-xs tracking-widest rounded-sm hover:brightness-110 transition-all shadow-[0_0_15px_rgba(212,175,55,0.3)] mb-4 disabled:opacity-60 disabled:cursor-not-allowed",disabled:e(y),onClick:T},s(e(y)?e(o)("cart.redirectingToPayment"):e(o)("cart.checkout")),9,St),t("button",{onClick:R,class:"w-full py-3 border border-primary/30 text-primary font-bold uppercase text-xs tracking-widest rounded-sm hover:bg-primary/10 transition-all",disabled:e(l)},s(e(o)("cart.clear")),9,Vt)])])]))])])}}};export{Wt as default};
