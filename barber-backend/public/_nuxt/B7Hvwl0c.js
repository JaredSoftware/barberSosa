import{a as n}from"./DxZUp_Ia.js";import{u as c}from"./DD9xvv_g.js";import{u as i}from"./CFgllcZz.js";import{e as y}from"./DubxvCNo.js";const _=()=>{const r=c("auth_token",()=>n.getToken()),t=c("auth_user",()=>null),u=c("auth_loading",()=>!1),l=async()=>{if(!r.value)return t.value=null,null;u.value=!0;try{return t.value=await n.getCurrentUser(r.value),t.value}catch(a){return console.error("Error obteniendo usuario:",a),n.removeToken(),r.value=null,t.value=null,null}finally{u.value=!1}},v=async(a,o)=>{u.value=!0;try{const e=await n.login(a,o);r.value=e.access_token,t.value=e.user;try{const{mergeCart:s}=i();await s(e.access_token)}catch(s){console.warn("Error fusionando carrito, continuando:",s)}return e}catch(e){throw console.error("Error en login:",e),e}finally{u.value=!1}},g=async a=>{u.value=!0;try{const o=await n.register(a);r.value=o.access_token,t.value=o.user;try{const{mergeCart:e}=i();await e(o.access_token)}catch(e){console.warn("Error fusionando carrito, continuando:",e)}return o}catch(o){throw console.error("Error en registro:",o),o}finally{u.value=!1}},f=()=>{n.loginWithGoogle()},h=async()=>{await n.logout(),r.value=null,t.value=null},d=a=>{typeof window<"u"&&(n.setToken(a),r.value=a,l())},m=y(()=>!!r.value);return r.value&&l(),{token:r,user:t,loading:u,fetchUser:l,login:v,register:g,loginWithGoogle:f,logout:h,setToken:d,isAuthenticated:m}};export{_ as u};
