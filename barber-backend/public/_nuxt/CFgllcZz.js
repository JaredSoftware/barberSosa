import{m as h,e as E}from"./DubxvCNo.js";import{u as s}from"./DD9xvv_g.js";const i={async getCart(c){try{const r=await fetch(`${c}/api/cart`,{credentials:"include",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error("Error al obtener carrito");return await r.json()}catch(r){return console.error("Error obteniendo carrito:",r),{items:[],updatedAt:new Date}}},async addToCart(c,r,e=1){const a=await fetch(`${c}/api/cart/items`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:r,quantity:e})});if(!a.ok){const o=await a.json().catch(()=>({message:"Error al añadir al carrito"}));throw new Error(o.message||"Error al añadir al carrito")}return await a.json()},async updateCartItem(c,r,e){const a=await fetch(`${c}/api/cart/items/${r}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:e})});if(!a.ok)throw new Error("Error al actualizar item");return await a.json()},async removeFromCart(c,r){const e=await fetch(`${c}/api/cart/items/${r}`,{method:"DELETE",credentials:"include"});if(!e.ok)throw new Error("Error al eliminar del carrito");return await e.json()},async clearCart(c){const r=await fetch(`${c}/api/cart`,{method:"DELETE",credentials:"include"});if(!r.ok)throw new Error("Error al vaciar carrito");return await r.json()},async createPaymentPreference(c,r={}){const e=await fetch(`${c}/api/payment/create-preference`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok){const a=await e.json().catch(()=>({}));throw new Error(a.message||"Error al crear el pago")}return await e.json()},async mergeCart(c,r){const e=await fetch(`${c}/api/cart/merge`,{method:"POST",credentials:"include",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(!e.ok)throw new Error("Error al fusionar carrito");return await e.json()}},T=()=>{const r=h().public.apiBase,e=s("cart",()=>({items:[],updatedAt:new Date})),a=s("cart_loading",()=>!1),o=s("cart_error",()=>null),m=E(()=>e.value.items.reduce((t,n)=>t+n.quantity,0)),d=async(t={})=>{const n=t.silent===!0;n||(a.value=!0),o.value=null;try{return e.value=await i.getCart(r),e.value}catch(l){return o.value=l.message||"Error al obtener carrito",console.error("Error obteniendo carrito:",l),e.value}finally{n||(a.value=!1)}},y=async(t,n=1)=>{a.value=!0,o.value=null;try{return e.value=await i.addToCart(r,t,n),e.value}catch(l){throw o.value=l.message||"Error al añadir al carrito",l}finally{a.value=!1}},f=async(t,n)=>{a.value=!0,o.value=null;try{return e.value=await i.updateCartItem(r,t,n),e.value}catch(l){throw o.value=l.message||"Error al actualizar",l}finally{a.value=!1}},p=async t=>{a.value=!0,o.value=null;try{return e.value=await i.removeFromCart(r,t),e.value}catch(n){throw o.value=n.message||"Error al eliminar",n}finally{a.value=!1}},v=async()=>{a.value=!0,o.value=null;try{return await i.clearCart(r),e.value={items:[],updatedAt:new Date},e.value}catch(t){throw o.value=t.message||"Error al vaciar carrito",t}finally{a.value=!1}},w=async t=>{a.value=!0,o.value=null;try{return e.value=await i.mergeCart(r,t),e.value}catch(n){return o.value=n.message||"Error al fusionar carrito",console.error("Error fusionando carrito:",n),e.value}finally{a.value=!1}},u=s("cart_payment_loading",()=>!1);return{cart:e,loading:a,error:o,totalItems:m,paymentLoading:u,fetchCart:d,addToCart:y,updateCartItem:f,removeFromCart:p,clearCart:v,mergeCart:w,createPaymentPreference:async(t={})=>{u.value=!0,o.value=null;try{return await i.createPaymentPreference(r,{payerEmail:t.payerEmail,payerName:t.payerName,payerSurname:t.payerSurname,externalReference:t.externalReference})}catch(n){throw o.value=n.message||"Error al iniciar el pago",n}finally{u.value=!1}}}};export{T as u};
