import{a as f}from"./DxZUp_Ia.js";import{u as w}from"./DD9xvv_g.js";var v={};const d=()=>typeof window<"u"?window.location.origin:v.NUXT_PUBLIC_API_BASE||"http://10.90.61.11",p={async getAll(t=!0){try{const e=`${d()}/api/products${t?"?active=true":""}`,c=await fetch(e,{headers:{"Content-Type":"application/json"}});if(!c.ok)throw new Error("Error al obtener productos");return await c.json()}catch(r){return console.error("Error obteniendo productos:",r),[]}},async getById(t){try{const r=d(),e=await fetch(`${r}/api/products/${t}`,{headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Error al obtener el producto");return await e.json()}catch(r){return console.error("Error obteniendo producto:",r),null}},async create(t,r){const e=d(),c=await fetch(`${e}/api/products`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(!c.ok){const s=await c.json().catch(()=>({message:"Error al crear el producto"})),u=s.message||(Array.isArray(s)?s.map(l=>l.message||l).join(", "):"Error al crear el producto");throw new Error(u)}return await c.json()},async update(t,r,e){const c=d(),s=await fetch(`${c}/api/products/${t}`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok){const u=await s.json().catch(()=>({message:"Error al actualizar el producto"})),l=u.message||(Array.isArray(u)?u.map(h=>h.message||h).join(", "):"Error al actualizar el producto");throw new Error(l)}return await s.json()},async delete(t,r){const e=d();if(!(await fetch(`${e}/api/products/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}})).ok)throw new Error("Error al eliminar el producto");return!0}},m=()=>{const t=w("products",()=>[]),r=w("products_loading",()=>!1),e=w("products_error",()=>null);return{products:t,loading:r,error:e,fetchProducts:async(n=!0)=>{r.value=!0,e.value=null;try{return t.value=await p.getAll(n),t.value}catch(o){return e.value=o.message||"Error al obtener productos",console.error("Error obteniendo productos:",o),[]}finally{r.value=!1}},fetchProductById:async n=>{r.value=!0,e.value=null;try{return await p.getById(n)}catch(o){return e.value=o.message||"Error al obtener el producto",console.error("Error obteniendo producto:",o),null}finally{r.value=!1}},createProduct:async n=>{const o=f.getToken();if(!o)throw new Error("No autenticado");r.value=!0,e.value=null;try{const a=await p.create(n,o);return t.value.push(a),a}catch(a){throw e.value=a.message||"Error al crear el producto",a}finally{r.value=!1}},updateProduct:async(n,o)=>{const a=f.getToken();if(!a)throw new Error("No autenticado");r.value=!0,e.value=null;try{const i=await p.update(n,o,a),y=t.value.findIndex(E=>E._id===n);return y!==-1&&(t.value[y]=i),i}catch(i){throw e.value=i.message||"Error al actualizar el producto",i}finally{r.value=!1}},deleteProduct:async n=>{const o=f.getToken();if(!o)throw new Error("No autenticado");r.value=!0,e.value=null;try{return await p.delete(n,o),t.value=t.value.filter(a=>a._id!==n),!0}catch(a){throw e.value=a.message||"Error al eliminar el producto",a}finally{r.value=!1}}}};export{m as u};
