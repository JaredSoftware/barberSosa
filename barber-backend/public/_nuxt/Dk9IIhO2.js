import{a as d}from"./DxZUp_Ia.js";import{u as f}from"./DD9xvv_g.js";var E={};const g=()=>typeof window<"u"?window.location.origin:E.NUXT_PUBLIC_API_BASE||"http://10.90.61.11",y={async getAll(a=!0){try{const r=`${g()}/api/categories${a?"?active=true":""}`,s=await fetch(r,{headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error("Error al obtener categorías");return await s.json()}catch(e){return console.error("Error obteniendo categorías:",e),[]}},async getById(a){try{const e=g(),r=await fetch(`${e}/api/categories/${a}`,{headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error("Error al obtener la categoría");return await r.json()}catch(e){return console.error("Error obteniendo categoría:",e),null}},async create(a,e){const r=g(),s=await fetch(`${r}/api/categories`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok){const c=await s.json().catch(()=>({message:"Error al crear la categoría"})),l=c.message||(Array.isArray(c)?c.map(i=>i.message||i).join(", "):"Error al crear la categoría");throw new Error(l)}return await s.json()},async update(a,e,r){const s=g(),c=await fetch(`${s}/api/categories/${a}`,{method:"PATCH",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!c.ok){const l=await c.json().catch(()=>({message:"Error al actualizar la categoría"})),i=l.message||(Array.isArray(l)?l.map(h=>h.message||h).join(", "):"Error al actualizar la categoría");throw new Error(i)}return await c.json()},async delete(a,e){const r=g();if(!(await fetch(`${r}/api/categories/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}})).ok)throw new Error("Error al eliminar la categoría");return!0}},m=()=>{const a=f("categories",()=>[]),e=f("categories_loading",()=>!1),r=f("categories_error",()=>null);return{categories:a,loading:e,error:r,fetchCategories:async(n=!0)=>{e.value=!0,r.value=null;try{return a.value=await y.getAll(n),a.value}catch(t){return r.value=t.message||"Error al obtener categorías",console.error("Error obteniendo categorías:",t),[]}finally{e.value=!1}},fetchCategoryById:async n=>{e.value=!0,r.value=null;try{return await y.getById(n)}catch(t){return r.value=t.message||"Error al obtener la categoría",console.error("Error obteniendo categoría:",t),null}finally{e.value=!1}},createCategory:async n=>{const t=d.getToken();if(!t)throw new Error("No autenticado");e.value=!0,r.value=null;try{const o=await y.create(n,t);return a.value.push(o),o}catch(o){throw r.value=o.message||"Error al crear la categoría",o}finally{e.value=!1}},updateCategory:async(n,t)=>{const o=d.getToken();if(!o)throw new Error("No autenticado");e.value=!0,r.value=null;try{const u=await y.update(n,t,o),w=a.value.findIndex(p=>p._id===n);return w!==-1&&(a.value[w]=u),u}catch(u){throw r.value=u.message||"Error al actualizar la categoría",u}finally{e.value=!1}},deleteCategory:async n=>{const t=d.getToken();if(!t)throw new Error("No autenticado");e.value=!0,r.value=null;try{return await y.delete(n,t),a.value=a.value.filter(o=>o._id!==n),!0}catch(o){throw r.value=o.message||"Error al eliminar la categoría",o}finally{e.value=!1}}}};export{m as u};
